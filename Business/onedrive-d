#!/bin/bash

local_folder="$1"
exec_path=$(readlink -f "$0")
export script_base_folder=$(dirname "$exec_path")

if [ ! -e "${script_base_folder}/onedrive" ]; then
  echo "Error! Not found 'onedrive'."
  exit 1
fi

function get_local_folder() {
    IFS=$'\n'
    for local_name in `ls -A1 .`
      do
        if [[ -d "${local_name}" ]]; then
          eval cd \'$local_name\'
          get_local_folder;
          cd ..
        else
          local_folder_name="$(readlink -f ./ |sed 's|'$local_folder_base'||' |sed 's|^/||')"
          eval "${script_base_folder}/onedrive" -f \'$local_folder_name\' \'$local_name\'
        fi
      done
    }

if [[ -d "${local_folder}" ]]; then
  dir -d "${local_folder}" >/dev/null 2>&1;
  if [[ $? -ne '0' ]]; then
    echo 'Error! Not access to the folder.';
    exit 1;
  fi
  cd "${local_folder}";
  local_folder_base="$(dirname $(readlink -f ./))";
  get_local_folder;
elif [[ -f "${local_folder}" ]]; then
  eval "${script_base_folder}/onedrive" \'$local_folder\';
fi
